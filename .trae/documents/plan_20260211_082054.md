
# Zustand 状态管理重构计划

## 1. 创建 Zustand Store
创建 `src/store/usePythonStore.ts`，统一管理编辑器状态、运行状态和执行结果。

- **状态定义 (`State`)**:
  - **编辑器状态**: `code` (代码), `breakpoints` (断点), `selectedTemplateId` (当前模板ID)。
  - **运行状态**: `isReady` (Worker就绪), `isRunning` (运行中), `isPaused` (暂停), `runStatus` (运行结果状态), `currentLine` (当前行)。
  - **执行结果**: `output` (输出日志), `variables` (变量), `outputDurationMs` (耗时)。

- **动作定义 (`Actions`)**:
  - 基础 Setter: `setCode`, `setIsReady`, `setRunStatus` 等。
  - 逻辑 Action: `toggleBreakpoint` (切换断点), `resetExecution` (重置运行状态), `appendOutput` (追加日志)。

## 2. 重构 `src/App.tsx`
将 `App.tsx` 中的 `useState` 替换为 `usePythonStore`，并精简组件逻辑。

- **移除本地 State**: 删除 `code`, `output`, `isRunning` 等 `useState` 定义。
- **接入 Store**: 使用 `usePythonStore` 获取状态和 Actions。
- **Worker 逻辑适配**: 更新 `initWorker`、`runCode`、`step`、`stopExec` 等函数，改为调用 Store 的 Actions 更新状态。
- **组件传参简化**: `RunControls` 和 `RightPanelStack` 可以直接从 Store 获取数据，或保持 Props 传递但源数据来自 Store。

## 3. 组件解耦 (可选优化)
为了进一步净化 `App.tsx`，可以考虑让部分子组件直接连接 Store（视情况而定，优先保证 `App.tsx` 逻辑清晰）。

- **RunControls**: 可直接消费 `isRunning`, `isPaused` 等状态。
- **RightPanelStack**: 可直接消费 `output`, `variables`, `breakpoints` 等数据。

## 4. 验证
- 运行 `npm run lint` 检查代码规范。
- 运行 `npm run build` 确保构建通过。
- 手动测试：加载模板、打断点、运行、暂停、单步执行、停止、查看输出和变量，确保功能与重构前一致。
