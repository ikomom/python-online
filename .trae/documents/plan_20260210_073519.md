# Build Client-Side Python Debugger (React 17 + Pyodide)

This plan outlines the steps to build a client-side Python debugger using React 17. The core architecture uses Pyodide in a Web Worker with SharedArrayBuffer for synchronous debugging.

## 1. Project Initialization (React 17)
*   **Initialize Project**: Create a Vite project and downgrade to React 17.
    *   Command: `npm create vite@latest . -- --template react-ts`
    *   Action: Manually install `react@17` and `react-dom@17`.
    *   Config: Update `vite.config.ts` to ensure compatibility and set **Cross-Origin headers** (Required for SharedArrayBuffer).
*   **Dependencies**:
    *   `pyodide`: The Python runtime.
    *   `@monaco-editor/react`: Code editor component.
    *   `clsx` / `tailwind-merge`: For styling utilities.

## 2. Infrastructure: Web Worker & Shared Memory
*   **Web Worker Setup**: Create `src/worker/pyodide.worker.ts`.
    *   This worker will load Pyodide and listen for messages from the main thread.
*   **SharedArrayBuffer (SAB)**:
    *   Create a `SharedArrayBuffer` in the React App.
    *   Send it to the Worker via `postMessage`.
    *   This buffer acts as the synchronization signal between UI and Python.

## 3. Core Debugging Logic ("The Freeze")
*   **Python Tracer**: Write a Python script (loaded by Pyodide) that uses `sys.settrace`.
    *   On every line execution, it checks if the line is in the `breakpoints` list.
    *   If paused, it writes to the SAB and calls `Atomics.wait()`, putting the worker to sleep.
*   **Main Thread Control**:
    *   Implement `run()`, `step()`, `continue()` functions in React.
    *   `step()`: Modifies the SAB and calls `Atomics.notify()` to wake up the worker.

## 4. UI Implementation
*   **Monaco Editor**:
    *   Configure `monaco-editor` to display line numbers and glyph margin.
    *   Handle mouse clicks in the margin to toggle breakpoints.
    *   Highlight the currently executing line (when paused).
*   **Control Panel**: Buttons for Run, Step Over, Continue.
*   **Output Console**: Display `stdout` captured from Pyodide.

## 5. Verification
*   **Environment Check**: Verify browser headers (COOP/COEP) are correct for SharedArrayBuffer.
*   **Functional Test**:
    *   Write a Python `for` loop.
    *   Set a breakpoint inside the loop.
    *   Verify the UI highlights the correct line and variables can be inspected (if scope implementation is added).
