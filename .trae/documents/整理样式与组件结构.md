## 目标
- 让项目更容易“复制到别的项目”并持续扩展：减少巨型组件、明确模块边界、样式可控且不互相污染。
- 保持现有行为稳定：先抽离/归类，再做统一规范。

## 现状观察（基于当前代码）
- [App.tsx](file:///d:/Project/web/ai-demo/python-online/src/App.tsx) 承担了：模板管理、Worker 通信、Monaco 装饰/错误、调试控制、断点同步、依赖弹窗等，后续扩展会越来越难维护。
- 样式来源分散：全局 [index.css](file:///d:/Project/web/ai-demo/python-online/src/index.css)（Tailwind + Monaco glyph 样式）+ [styles/index.scss](file:///d:/Project/web/ai-demo/python-online/src/styles/index.scss)（split-pane / theme）+ [App.css](file:///d:/Project/web/ai-demo/python-online/src/App.css)（局部）+ 组件内大量 Tailwind class。
- 组件有“通用组件”（CollapsiblePanel）和“业务组件”（BreakpointPanel/VariablePanel/ExtraDepsModal）混在不同目录。

## 推荐的目录与模块边界（可渐进迁移）
- **app/**：应用壳与 Provider（未来如 Antd ConfigProvider、全局错误边界、路由）
- **features/**：按功能域拆分（可复用/可替换）
  - features/editor：Monaco 初始化、装饰、hover/completion（把 [setupMonaco.ts](file:///d:/Project/web/ai-demo/python-online/src/monaco/setupMonaco.ts) 归入）
  - features/python-runner：Worker 协议、执行/调试状态机（把 worker 通信与 SAB 协议从 App 抽走）
  - features/deps：ExtraDepsModal + 依赖加载逻辑（UI 与逻辑分层）
- **widgets/**：把多个 feature 组合成页面区域（例如 RightPanelStack + 面板组合）
- **shared/**：跨项目可复用的“基础设施”
  - shared/ui：CollapsiblePanel、可能的 IconButton、EmptyState 等
  - shared/lib：小工具（例如 className 合并 cn、key 规范化等）
  - shared/styles：全局样式/主题变量/Monaco 专属样式

## 组件整理建议（重点：可维护 + 可扩展）
- **把 App.tsx 拆成 3 类东西**
  1) UI 组合（Header/Editor/RightPanel 结构）
  2) 领域逻辑 hook（如 usePyRunner/useBreakpoints/useRunMarkers/useTemplates）
  3) 协议层（worker message、SAB 布局常量）
- **“展示组件”与“逻辑组件”分离**
  - BreakpointPanel/VariablePanel/OutputPanel 保持纯展示（props 输入完整），不要直接读 store
  - RightPanelStack 作为 widget 负责从 store 取数据并组装

## 样式整理策略（Tailwind + Antd + 少量全局 CSS/SCSS）
- **全局样式只保留三类**
  1) Reset/布局（html/body/#root）
  2) Monaco glyph/装饰类（例如 my-glyph-margin-* 这类必须全局的）
  3) SplitPane/theme（现有 SCSS）
- **Monaco glyph 类集中到一个文件**（例如 shared/styles/monaco-glyph.css），避免 index.css 越来越大。
- **主题与颜色统一走 CSS 变量**（你已有 theme.scss）：
  - 在 theme.scss 定义 token：--color-accent、--color-danger、--radius-sm、--space-2 …
  - Tailwind 用这些变量（tailwind.config.js 的 theme.extend.colors/spacing）映射，Antd 也可通过 ConfigProvider token 逐步对齐。

## 命名/约定（方便团队协作）
- 组件：
  - 纯 UI：XxxPanel / XxxModal / XxxButton
  - hook：useXxx
  - Worker 协议：message 类型与 SAB 索引统一放一个 constants 模块
- CSS：
  - Monaco 专属类统一前缀 monaco-glyph-*（或保留 my-glyph-* 但集中管理）

## 格式与代码风格（让别人接手成本更低）
- ESLint 已有（见 [eslint.config.js](file:///d:/Project/web/ai-demo/python-online/eslint.config.js)），建议补齐：
  - Prettier（统一格式，避免不同项目拷贝后风格漂移）
  - import 分组/排序（可选）
  - 统一文件头 import 顺序（react、三方、内部、样式）

## 迁移步骤（低风险、可随时停）
1) 抽离 worker 协议常量与 SAB 布局到独立模块（不改逻辑，只搬）
2) 把“断点/装饰/错误 marker/模板切换”分别提炼为 hooks，App.tsx 只做组合
3) 把 Monaco glyph 样式从 index.css 拆出到 shared/styles；保留 index.css 只做 tailwind + reset
4) 统一主题 token（theme.scss + tailwind.config.js 映射），逐步消除硬编码颜色
5) 最后再做目录重命名/移动（features/widgets/shared），并加 barrel export（index.ts）

如果你确认，我会按“先抽离协议常量 + 拆 App.tsx 的 hooks + 归拢样式文件”的顺序开始整理，保证每一步都能 lint/build 通过。